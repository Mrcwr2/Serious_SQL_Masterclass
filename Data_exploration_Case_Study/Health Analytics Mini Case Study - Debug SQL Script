Health Analytics Mini CCase Study

We’ve just received an urgent request from the General Manager of Analytics at Health Co requesting our assistance with their analysis of the health.user_logs dataset.

The Health Co analytics team have shared with us their SQL script - they unfortunately ran into a few bugs that they couldn’t fix!

We’ve been asked to quickly debug their SQL script and use the resulting query outputs to quickly answer a few questions that the GM has requested for a board meeting about their active users.

Business Questions
Before we start digging into the SQL script - let’s cover the business questions that we need to help the GM answer!

How many unique users exist in the logs dataset?
How many total measurements do we have per user on average?
What about the median number of measurements per user?
How many users have 3 or more measurements?
How many users have 1,000 or more measurements?
Looking at the logs data - what is the number and percentage of the active user base who:

Have logged blood glucose measurements?
Have at least 2 types of measurements?
Have all 3 measures - blood glucose, weight and blood pressure?
For users that have blood pressure measurements:

What is the median systolic/diastolic blood pressure values?
Debug SQL Script
Below is the script that the Health Co analytics team was working on - I suggest making a copy and pasting this code into your favourite editor or the SQLPad GUI to start debugging it!

I highly recommend keeping all the code you write for this case study in a local text file or note as it might come in handy later when you want to start building your SQL project portfolio!




-- 1. How many unique users exist in the logs dataset?
--SELECT
  --COUNT DISTINCT user_id
--FROM health.user_logs;

--Correction

SELECT
  COUNT (DISTINCT id) AS Unique_id_count
FROM health.user_logs;


-- for questions 2-8 we created a temporary table
--DROP TABLE IF EXISTS user_measure_count;
--CREATE TEMP TABLE user_measure_cout
--SELECT
    --id,
    --COUNT(*) AS measure_count,
    --COUNT(DISTINCT measure) as unique_measures
  --FROM health.user_logs
  --GROUP BY 1;


  --Correction
  DROP TABLE IF EXISTS user_measure_count;
CREATE TEMP TABLE user_measure_cout AS
SELECT
    id,
    COUNT(*) AS measure_count,
    COUNT(DISTINCT measure) as unique_measures
  FROM health.user_logs
  GROUP BY 1;

-- 2. How many total measurements do we have per user on average?
--SELECT
  --ROUND(MEAN(measure_count))
--FROM user_measure_count;

--Correction
SELECT
  AVG(measure_count)
FROM user_measure_count;


-- 3. What about the median number of measurements per user?
SELECT
  PERCENTILE_CONTINUOUS(0.5) WITHIN GROUP (ORDER BY id) AS median_value
FROM user_measure_count;

-- 4. How many users have 3 or more measurements?
SELECT
  COUNT(*)
FROM user_measure_count
HAVING measure >= 3;

-- 5. How many users have 1,000 or more measurements?
SELECT
  SUM(id)
FROM user_measure_count
WHERE measure_count >= 1000;

-- 6. Have logged blood glucose measurements?
SELECT
  COUNT DISTINCT id
FROM health.user_logs
WHERE measure is 'blood_sugar';

-- 7. Have at least 2 types of measurements?
SELECT
  COUNT(*)
FROM user_measure_count
WHERE COUNT(DISTINCT measures) >= 2;

-- 8. Have all 3 measures - blood glucose, weight and blood pressure?
SELECT
  COUNT(*)
FROM usr_measure_count
WHERE unique_measures = 3;

-- 9.  What is the median systolic/diastolic blood pressure values?
SELECT
  PERCENTILE_CONT(0.5) WITHIN (ORDER BY systolic) AS median_systolic
  PERCENTILE_CONT(0.5) WITHIN (ORDER BY diastolic) AS median_diastolic
FROM health.user_logs
WHERE measure is blood_pressure;
